#!/usr/bin/perl

use strict;
use warnings;

use EBox;
use EBox::Global;


EBox::init();

my $remoteServices = EBox::Global->modInstance('remoteservices');
$remoteServices->_lock();

my $alreadyChanged = $remoteServices->changed();
my $subscriptionInfo = $remoteServices->refreshSubscriptionInfo();

if ($remoteServices->changed() and not $alreadyChanged) {
    # changes due to subscription refresh
    $remoteServices->_saveConfig();
    $remoteServices->setAsChanged(0);
}

$remoteServices->setupSubscription($subscriptionInfo);

$remoteServices->_unlock();

1;
