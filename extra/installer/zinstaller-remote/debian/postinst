#!/bin/sh

. /usr/share/debconf/confmodule

URL=archive.zentyal.com/zentyal-qa/

DATA_DIR=/tmp/zinstaller-remote

mkdir -p $DATA_DIR

while true
do
    db_input high zinstaller-remote/user
    db_go
    db_get zinstaller-remote/user
    USERNAME="$RET"
    if [ -z "$USERNAME" ]
    then
        exit 0
    fi

    db_input high zinstaller-remote/pass
    db_go
    db_get zinstaller-remote/pass
    PASSWORD="$RET"

    if wget --user=$USERNAME --password=$PASSWORD $URL -O- | grep Index
    then
        break
    fi

    db_input high zinstaller-remote/auth_failed
    db_go
done

db_input high zinstaller-remote/auth_ok
db_go

echo $USERNAME > $DATA_DIR/QA_USERNAME
echo $PASSWORD > $DATA_DIR/QA_PASSWORD
echo $USERNAME > $DATA_DIR/REGISTER_USERNAME
echo $PASSWORD > $DATA_DIR/REGISTER_PASSWORD

touch $DATA_DIR/COMMERCIAL_EDITION

exit 0
